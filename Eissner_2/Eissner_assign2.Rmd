---
title: "Eissner_assign2"
author: "Jordan Eissner"
date: "March 14, 2018"
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



### Abstract





### Introduction



### Data and Methods

In this study, mean annual temperature and precipitation data from thousands of stations across the U.S were analyzed. The data from each station consisted of 59 values, ranging from 1950 to 2008, or in some cases, 2010. For some years in some stations, there was no data available. For each station, if there was less than 40 years of data available, the station was removed. With the remaining data, a time series linear model was made with the data at each station. The trend in the data was determined to be the slope of that time series. Each location's trend was then plotted on a map, with different colors corresponding to different values. A blue color represents a negative trend while a red color represents a positive trend. Maps of both temperature and precipitation were made. 

```{r data, echo=FALSE}

DataMatrix <- function(data,na_thresh){
# make list of all names, lats, and lons
n <- unique(data [,c("name","lon","lat")])
namelist <- n$name
latlist <- n$lat
lonlist <- n$lon
yearlist <- unique(data$year)
colnames(n) <- c('name', 'lat', 'lon')


# put data into a matrix with each location as a row and each year as a column
m <- matrix(data=data$data, nrow = length(namelist), ncol = length(yearlist), byrow=TRUE)

rownames(m) <- namelist
colnames(m) <- yearlist

r <- cbind(n,m)

# delete rows with more than threshold NA values
delete.na <- function(DF, a=0) {
  DF[rowSums(is.na(DF)) <= a,]
}
new_dat <- delete.na(r, na_thresh)
dat_only <- delete.na(m, na_thresh)
new_namelist <- new_dat$name
new_latlist <- new_dat$lat
new_lonlist <- new_dat$lon


return(list(dat_only=dat_only, latlist=new_latlist, lonlist=new_lonlist))
}
```


```{r trend, echo=FALSE}
Trend <- function(data) {
  yearlist <- colnames(data)
  namelist <- rownames(data)
  
  tm <- t(data)
  trend <- c()
  for(i in 1:length(namelist)){
    lm <- lm(yearlist ~ tm[,i])
    coeff <- lm$coefficients[2]
    trend <- c(trend,coeff)
  }
  
  return(trend)
}

```

### Results
The trends are plotted for temperature and precipitation in figure 1. The temperature plot shows mostly warming (positive) trends for much of the United States. There are several locations that show a cooling (negative) trend, which are mostly located on the West Coast, in California. There are also some cooling trends on the East Coast, in Florida, and New York. The southern states also seem to have larger warming trends than states in the north.


The precipitation trend plot shows that there is an increase in precipitation for the majority of the stations. The only negative trends are found in eastern Ohio. The trends in Alabama and Tennessee are larger than those in Ohio, which correspond to larger, positive trends in temperature. 


```{r maps, echo=FALSE}
Map <- function(trend, lonlist, latlist){
  
  rbPal <- colorRampPalette(c('red','yellow','blue'))
  Cols <- rbPal(10)[as.numeric(cut(trend,breaks=10))]
  
  map("usa", fill=FALSE, plot=TRUE)
  points(lonlist, latlist, col = Cols, pch =19, cex = .6)
  #legend("bottomleft", legend=c("Pos","Neg"), col=trend$Col, fill=trend$Col)
}
 
```

```{r usefuncs, echo=FALSE}
library(maps)
library(graphics)
library(mapproj)


# provided <- TRUE
# if(provided<-TRUE){
#   tempdat <- readRDS("USAAnnualTemp1950_2008.rds")
#   precdat <- readRDS("USAAnnualPcpn1950_2008.rds")
#   tempdat2 <- readRDS("USAannualTemp1950_2016.rds")
# } 
# else{
#   
# }


tempdat <- readRDS("USAAnnualTemp1950_2008.rds")
precdat <- readRDS("USAAnnualPcpn1950_2008.rds")
tempdat2 <- readRDS("USAannualTemp1950_2016.rds")


na_thresh <- 18 # remove station data if it has more than a threshold of NA values


datasets <- list(tempdat, precdat)

for (datasets in datasets){
  i <- get("datasets")
  #print(i['name'])


new_data <- DataMatrix(i,na_thresh)$dat_only
latlist <- DataMatrix(i,na_thresh)$latlist
lonlist <- DataMatrix(i,na_thresh)$lonlist

trend_data <- Trend(new_data)

Map(trend_data, latlist, lonlist)
}



```





### Discussion



### References 



